# Dead Lock 

> Dead Lock

![교착사앹](https://user-images.githubusercontent.com/62277037/143671407-dd395781-620f-4a18-86bd-d490dffcffab.PNG)


  프로세스가 결코 일어나지 않을 사건을 기다리는 상태가 되면 교착 상태라고 한다.
  두 프로세스가 사용하는 자원을 서로 기다리고 있을 때 발생한다.
  
  * 교착 상태에 빠지면 작업이 정지되어 더는 명령을 진행하지 못한다.
  * 교착 상태를 해결하지 못하면, 시스템 운영자나 사용자는 작업을 교체하거나 종료하는 외부 간섭으로 이것을 해결해야 한다.

> Dead Lock 발생 조건

  * 상호배제(Mutual Exclusion) : 자원을 최소 하나 이상 비공유해야 한다. 즉, 한 번에 프로세스 하나만 해당 자원을 사용할 수 있어야 한다. 사용 중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제될 때까지 기다려야 한다.
  * 점유와 대기(Hold and Wait) : 자원을 최소한 하나 정도는 보유하고, 다른 프로세스에 할당된 자원을 얻으려고 기다리는 프로세스가 있어야 한다.
  * 비선점(Non-preemptive) : 자원은 강제로 빼앗을 수 없고, 자원을 점유하고 있는 프로세스가 끝나야 해제된다.
  * 순환 대기(Circuit wait) : 보유한 자원을 각각 얻으려고 기다리는 것을 순환 대기라고 한다.

> 선점자원과 비선점 자원

  * 선점 자원(Preemptive) : 부작용 없이 소유한 프로세스에서 빼앗아 선점할 수 있는 자원이다. 일정 시간 동안 특정 프로세스에 할당했다가 다른 프로세스에 할당하고, 다시 부작용 없이 처음 프로세스에 재할당할 수 있다.(메모리, 버퍼, 프로세서)
  * 비선점 자원(Non Preemprive) : 하나의 프로세스에서 빼앗아 선점할 수 없고, 부작용 없이 다른 프로세스에 할당할 수 없는 자원이다. 

> 교착 상태 해결 방법

  * 예방(Prevention)

    * 필요한 자원을 한 번에 모두 요청해야 하며, 요청한 자원을 모두 제공받기 전까지는 작업을 진행할 수 없다.
    * 어떤 자원을 점유하고 있는 프로세스의 요청을 더 이상 허용하지 않으면 점유한 자원을 모두 반납하고, 필요할 때 다시 자원을 요청해야 한다.
    * 모든 프로세스에 자원을 순서대로 할당해야 한다. 각 자원 유형별로 할당 순서를 부여한 후 순서에 따라 자원을 요청하게 된다.

  * 4가지 방법

    * 자원의 상호배제 조건 방지 : 자원의 비공유가 전제되어야 한다. 공유할 수 없는 자원을 사용할 때 성립된다.
    * 점유와 대기 조건 방지 : 프로세스가 작업을 수행하기 전에 필요한 자원을 모두 요청하고 획득해야 한다.
    * 비선점 조건 방지 : 이미 할당된 자원에 선점권이 없어야 한다는 것이다. 어떤 자원을 가지고 있는 프로세스가 더 이상 자원 할당 요구가 없으면 가지고 있던 자원 반납, 필요시 자원 요구함.
    * 순환 대기 조건 방지 : 모든 자원에 일련의 순서를 부여하고 각 프로세스가 오름차순으로만 자원을 요청할 수 있게 한다.

  * 회피(Avoidance)
  
    * 교착상태가 발생하려고 할 때 적절하게 회피하는 방법이다. 위의 예방에 비해 비용이 적게든다.
    * 은행가 알고리즘 : 자원의 할당 허용 여부를 결정하기 전에 미리 결정된 모든 자원의 최대 가능한 할당량을 시뮬레이션하여 안전 여부를 검사한다. 운영체제는 안전 상태를 유지할 수 있는 요구만을 수락하고 불안전 상태를 초래할 사용자의 요구는 나중에 만족될 때까지 거절한다.

  * 탐지(Detection)
    
    * 교착 상태 탐지 알고리즘을 자주 실행하면 시스템의 성능은 떨어지지만, 교착 상태에 빠진 프로세스를 빨리 발견하여 자원의 유휴 상태를 방지할 수 있다. 

  * 회복(Recovery)

    * 교착 상태에서 회복한다는 것은 순환 대기에서 벗어난다는 것이다. 프로세스를 한 개 이상 중단하는 방법과, 교착 상태의 프로세스들에서 자원을 선점하는 방법이 있다.
    * 프로세스 중단 : 교착 상태 프로세스를 모두 중단(자원 사용과 시간면 비용이 많이 든다.) , 한 프로세스씩 중단(교착 상태 탐지 알고리즘을 호출하여 프로세스가 교착 상태에 있는지 확인.)
    * 자원 선점 : 프로세스의 자원을 선점해서 교착 상태를 해결할 때까지 선점한 자원을 다른 프로세스에 할당해야 한다.
      * 선점 자원 선택 : 적절한 선점 순서를 결정해야 한다.
      * 복귀 : 프로세스를 안정 상태로 복귀시키고 다시 시작해야 한다.
      * 기아 : 동일한 프로세스가 자원들을 항상 선점하지 않도록 보장하려고 할 때 비용이 기반인 시스템에서는 동일한 프로세스를 희생자로 선택한다. 이 프로세스는 작업을 완료하지 못하는 기아 상태가 되어 시스템 조치를 요청한다.

> 기아 상태

교착 상태가 자원을 자유롭게 할당한 결과(자원 부족)라면, 반대로 기아 상태는 작업이 결코 사용할 수 없는 자원을 계속 기다리는 결과(교착 상태)를 예방하려고 자원을 할당할 때 발생(기다림) 하는 결과이다.
작업이 결코 사용할 수 없는 자원을 계속 기다리는 결과를 예방하려고 자원을 할당할 때 발생하는 결과이다.
